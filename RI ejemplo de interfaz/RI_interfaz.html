<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulario</title>
    <link rel="stylesheet" type="text/css" href="RI.css">


</head>
<body>
     
    <h2> Requisitos de Inicio</h2>
   

    <form id="myForm" enctype="multipart/form-data">
        <label for="opciones">Selecciona una opción:</label>
        <select id="opciones" name="opciones" onchange="mostrarDescripcion()">
            <option value="0">Seleccione un Requisito</option>
            <option value="1">Opción 1</option>
            <option value="2">Opción 2</option>
            <option value="3">Opción 3</option>
            <option value="4">Opción 4</option>
            <option value="5">Opción 5</option>
            <option value="6">Opción 6</option>
            <option value="7">Opción 7</option>
            <option value="8">Opción 8</option>
            <option value="9">Opción 9</option>
            <option value="10">Opción 10</option>
            <option value="11">Opción 11</option>
            <option value="12">Opción 12</option>
            <option value="13">Opción 13</option>
            <option value="14">Opción 14</option>
            <!-- Agrega las demás opciones -->
        </select>
        <br>
        <div id="botonCrearDocumento" style="display: none;">
    <button onclick="crearDocumento()">Crear documento</button>
</div>
       

        
        <div id="descripcion-container">
            <label for="descripcion">Descripción:</label>
            <input type="text" id="descripcion" name="descripcion" readonly>
        </div>
        <br>
        <div id="vistaPrevia" style="display: none;">
            <h3>Vista Previa del Documento</h3>
            <iframe id="iframeVistaPrevia" width="100%" height="400"></iframe>
        </div>

        <label for="archivo">Selecciona un archivo (PDF, Word o JPG no mayor a 700 KB):</label>
        <input type="file" id="archivo" name="archivo" accept=".pdf, .doc, .docx, .jpg" required>
        <br>

        <button type="button" onclick="submitForm()">Subir Archivo</button>
    </form>

    <h2>Archivos Cargados</h2>

    <table border="1">
        <thead>
            <tr>
                <th>Requisto</th>
                <th>Nombre </th>
                <th>Archivo</th>
                <th>Descargar</th>
                <th>Eliminar</th>
                <th>Vista Previa</th>
            </tr>
        </thead>
        <tbody id="tablaArchivos">
            <!-- Aquí se mostrarán los archivos cargados -->
        </tbody>
    </table>

    <script>
        let opcionCounter = {};

        function mostrarDescripcion() {
            // Obtener la opción seleccionada
            const opcionSeleccionada = document.getElementById('opciones').value;

            // Definir un objeto con las descripciones correspondientes a cada opción
            const descripciones = {
                '1': 'Desempeño a la docencia',
                '2': 'Constancia académica',
                '7': 'Opción especial 7', // Agrega la descripción para la opción 7
            };

            // Obtener la descripción correspondiente a la opción seleccionada
            const descripcionSeleccionada = descripciones[opcionSeleccionada] || 'Descripción predeterminada';

            // Mostrar la descripción en el campo correspondiente
            const descripcionCampo = document.getElementById('descripcion');
            descripcionCampo.value = descripcionSeleccionada;

            // Mostrar el botón "Crear documento" si la opción es 7
            const botonCrearDocumento = document.getElementById('botonCrearDocumento');
            botonCrearDocumento.style.display = (opcionSeleccionada === '7') ? 'block' : 'none';
        }
        function limpiarFormulario() {
        // Limpiar el campo de opciones
        document.getElementById('opciones').value = '0';

        // Ocultar el botón "Crear documento"
        document.getElementById('botonCrearDocumento').style.display = 'none';

        // Limpiar el campo de descripción
        document.getElementById('descripcion').value = '';

        // Ocultar la vista previa
        document.getElementById('vistaPrevia').style.display = 'none';

        // Limpiar el campo de archivo
        document.getElementById('archivo').value = '';

        // Limpiar el iframe de vista previa
        document.getElementById('iframeVistaPrevia').src = '';

        // Enfocar el campo de opciones para una mejor experiencia de usuario
        document.getElementById('opciones').focus();
    }

       
function mostrarVistaPrevia(archivo, iframeId) {
    const vistaPreviaDiv = document.getElementById('vistaPrevia');
    const iframeVistaPrevia = document.getElementById(iframeId);

    // Verificar si el archivo es compatible con la vista previa (PDF, Word, etc.)
    if (archivo.type === 'application/pdf' || archivo.type === 'application/msword' || archivo.type === 'application/vnd.openxmlformats-officedocument.wordprocessingml.document') {
        // Mostrar la vista previa
        vistaPreviaDiv.style.display = 'block';
        // Leer el contenido del archivo y mostrarlo en el iframe
        const lector = new FileReader();
        lector.onload = function (e) {
            iframeVistaPrevia.src = e.target.result;
        };
        lector.readAsDataURL(archivo);
    } else {
        // Ocultar la vista previa si el archivo no es compatible
        vistaPreviaDiv.style.display = 'none';
    }
}

        
        function crearDocumento() {
        // Puedes redirigir a otra página utilizando window.location.href
        window.location.href = 'Generar_RI7.html';
        // Reemplaza 'otra_interfaz.html' con la URL de la interfaz a la que deseas redirigir
         }

        function cambiarNombreArchivo(originalName, opcion) {
            // Obtener la extensión del archivo
            const extension = originalName.split('.').pop();

            // Construir un nuevo nombre con la opción y el contador
            const nuevoNombre = opcion + '.' + opcionCounter[opcion] + '.' + extension;

            return nuevoNombre;
        }

        function ordenarFilas() {
            // Obtener la tabla y las filas
            const tablaArchivos = document.getElementById('tablaArchivos');
            const rows = tablaArchivos.getElementsByTagName('tr');

            // Ordenar las filas según el valor de la primera celda
            const rowsArray = Array.from(rows);
            rowsArray.sort((a, b) => {
                const aValue = a.cells[0].innerHTML;
                const bValue = b.cells[0].innerHTML;
                return aValue.localeCompare(bValue, undefined, { numeric: true, sensitivity: 'base' });
            });

            // Actualizar la tabla con las filas ordenadas
            for (let i = 0; i < rowsArray.length; i++) {
                tablaArchivos.appendChild(rowsArray[i]);
            }
        }

        function eliminarArchivo(element) {
            // Aquí puedes implementar el código para eliminar el archivo de la nube y actualizar la base de datos
            const row = element.parentNode.parentNode;
            row.parentNode.removeChild(row);
        }
        
    const nombresOpciones = {
        '1': 'Tacos Azules',
        '2': 'Tacos Negros',
        '3': 'Nombre Opción 3',
        // Agrega los nombres para las demás opciones según sea necesario
    };

    function submitForm() {
        // Obtener los valores del formulario
        const opcionSeleccionada = document.getElementById('opciones').value;
        const archivoSeleccionado = document.getElementById('archivo').files[0];

        // Cambiar el nombre del archivo
        const nombreArchivo = cambiarNombreArchivo(archivoSeleccionado.name, opcionSeleccionada);

        // Incrementar el contador de la opción seleccionada
        if (!opcionCounter[opcionSeleccionada]) {
            opcionCounter[opcionSeleccionada] = 1;
        } else {
            opcionCounter[opcionSeleccionada]++;
        }

        // Crear una nueva fila
        const tablaArchivos = document.getElementById('tablaArchivos');
        const newRow = tablaArchivos.insertRow(-1);
        const cell1 = newRow.insertCell(0);
        const cell2 = newRow.insertCell(1);
        const cell3 = newRow.insertCell(2);
        const cell4 = newRow.insertCell(3);
        const cell5 = newRow.insertCell(4);
        const cell6 = newRow.insertCell(5); // Nueva celda para la vista previa

        // Asignar valores a las celdas
        cell1.innerHTML = opcionSeleccionada + '.' + opcionCounter[opcionSeleccionada];
        cell2.innerHTML = nombresOpciones[opcionSeleccionada] || opcionSeleccionada; // Utilizar el nombre personalizado o el valor de la opción
        cell3.innerHTML = nombreArchivo;
        cell4.innerHTML = '<a href="#">Descargar</a>';
        cell5.innerHTML = '<a href="#" onclick="eliminarArchivo(this)">Eliminar</a>';

        // Mostrar la vista previa
        const vistaPreviaLink = document.createElement('a');
        vistaPreviaLink.href = '#';
        vistaPreviaLink.textContent = 'Vista previa';
        vistaPreviaLink.onclick = function () {
            mostrarVistaPrevia(archivoSeleccionado);
        };
        cell6.appendChild(vistaPreviaLink);

        // Ordenar las filas según la primera celda (Opción)
        ordenarFilas();

        // Limpiar el formulario después de subir el archivo
        limpiarFormulario();
    }
    </script>
</body>
</html>
